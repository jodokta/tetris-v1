{"ast":null,"code":"import _slicedToArray from\"/Users/Pajamas/Project/tetris_pro/tetris/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{StyledTetrisWrapper,StyledTetris}from\"../../css/StyledTetris\";import{useState}from\"react\";// Components\nimport Stage from\"./Stage\";import Display from\"./Display\";import StartButton from\"./StartButton\";import GameOver from\"./GameOver\";// Custom Hooks\nimport{usePlayer}from\"../../hooks/tetris/usePlayer\";import{useStage}from\"../../hooks/tetris/useStage\";import{useInterval}from\"../../hooks/tetris/useInterval\";import{useStats}from\"../../hooks/tetris/useStats\";// Help, Constance\nimport{checkCollision,createStage}from\"../../gameHelpers\";import Preview from\"./Preview\";import{queue}from\"../../constants\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Tetris=function Tetris(_ref){var setIsStart=_ref.setIsStart;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isPlaying=_useState2[0],setIsPlaying=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),dropTime=_useState4[0],setDropTime=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),gameOver=_useState6[0],setGameOver=_useState6[1];var _usePlayer=usePlayer(),_usePlayer2=_slicedToArray(_usePlayer,4),player=_usePlayer2[0],updatePlayerPos=_usePlayer2[1],resetPlayer=_usePlayer2[2],playerRotate=_usePlayer2[3];var _useStage=useStage(player,resetPlayer),_useStage2=_slicedToArray(_useStage,4),stage=_useStage2[0],setStage=_useStage2[1],rowsCleared=_useStage2[2],ghostPositions=_useStage2[3];var _useStats=useStats(rowsCleared),_useStats2=_slicedToArray(_useStats,6),score=_useStats2[0],setScore=_useStats2[1],rows=_useStats2[2],setRows=_useStats2[3],level=_useStats2[4],setlevel=_useStats2[5];var movePlayer=function movePlayer(dir){// check x-1, x+1\nif(!checkCollision(player,stage,{x:dir,y:0})){updatePlayerPos({x:dir,y:0});}};var startGame=function startGame(e){setIsPlaying(true);var target=document.getElementById('TetrisWrpper');e.target.blur();target.focus();// Reset all\nsetDropTime(1000);setStage(createStage());resetPlayer();setGameOver(false);setScore(0);setRows(0);setlevel(1);};var drop=function drop(){//레벨 증가\nif(rows>(level+1)*10){setlevel(function(prev){return prev+1;});// 속도 증가\nsetDropTime(1000/(level+1)+200);}if(!checkCollision(player,stage,{x:0,y:1})){//다음 y좌표가 이동이 가능하면 블럭 한칸 내림\nupdatePlayerPos({x:0,y:1,collide:false});}else{//Game Over\n//다음 y좌표 이동 불가 + 현재 죄표가 1보다 작다면? Game Over\nif(player.pos.y<1){// console.log('Game Over!!!');\nsetGameOver(true);setDropTime(null);}updatePlayerPos({x:0,y:0,collide:true});setDropTime(1000/(level+1)+200);}};var keyUp=function keyUp(_ref2){var keyCode=_ref2.keyCode;if(!gameOver){if(keyCode===40){setDropTime(1000);}}};var dropPlayer=function dropPlayer(){setDropTime(null);drop();};var hardDrop=function hardDrop(){setDropTime(0);};var move=function move(_ref3){var keyCode=_ref3.keyCode;if(!gameOver){if(keyCode===37){movePlayer(-1);}else if(keyCode===39){movePlayer(1);}else if(keyCode===38){playerRotate(stage,1);}else if(keyCode===32){hardDrop();}else if(keyCode===40){dropPlayer();}}};useInterval(function(){drop();},dropTime);return/*#__PURE__*/_jsx(StyledTetrisWrapper,{id:\"TetrisWrpper\",role:\"button\",tabIndex:\"0\",onKeyDown:function onKeyDown(e){return move(e);},onKeyUp:keyUp,children:gameOver?/*#__PURE__*/_jsx(GameOver,{score:score,restart:startGame,setIsStart:setIsStart}):/*#__PURE__*/_jsxs(StyledTetris,{children:[/*#__PURE__*/_jsx(Stage,{stage:stage,ghostPos:ghostPositions}),/*#__PURE__*/_jsxs(\"aside\",{children:[/*#__PURE__*/_jsx(Preview,{queue:queue}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Display,{text:\"Score : \".concat(score)}),/*#__PURE__*/_jsx(Display,{text:\"Lines : \".concat(rows)}),/*#__PURE__*/_jsx(Display,{text:\"Level : \".concat(level)}),/*#__PURE__*/_jsx(StartButton,{callback:startGame,isPlaying:isPlaying})]})]})]})});};export default Tetris;","map":{"version":3,"names":["StyledTetrisWrapper","StyledTetris","useState","Stage","Display","StartButton","GameOver","usePlayer","useStage","useInterval","useStats","checkCollision","createStage","Preview","queue","jsx","_jsx","jsxs","_jsxs","Tetris","_ref","setIsStart","_useState","_useState2","_slicedToArray","isPlaying","setIsPlaying","_useState3","_useState4","dropTime","setDropTime","_useState5","_useState6","gameOver","setGameOver","_usePlayer","_usePlayer2","player","updatePlayerPos","resetPlayer","playerRotate","_useStage","_useStage2","stage","setStage","rowsCleared","ghostPositions","_useStats","_useStats2","score","setScore","rows","setRows","level","setlevel","movePlayer","dir","x","y","startGame","e","target","document","getElementById","blur","focus","drop","prev","collide","pos","keyUp","_ref2","keyCode","dropPlayer","hardDrop","move","_ref3","id","role","tabIndex","onKeyDown","onKeyUp","children","restart","ghostPos","text","concat","callback"],"sources":["/Users/Pajamas/Project/tetris_pro/tetris/src/components/Tetris/Tetris.js"],"sourcesContent":["import { StyledTetrisWrapper, StyledTetris } from \"../../css/StyledTetris\";\n\nimport { useState } from \"react\";\n\n// Components\nimport Stage from \"./Stage\";\nimport Display from \"./Display\";\nimport StartButton from \"./StartButton\";\nimport GameOver from \"./GameOver\";\n\n// Custom Hooks\nimport { usePlayer } from \"../../hooks/tetris/usePlayer\";\nimport { useStage } from \"../../hooks/tetris/useStage\";\nimport { useInterval } from \"../../hooks/tetris/useInterval\";\nimport { useStats } from \"../../hooks/tetris/useStats\";\n\n// Help, Constance\nimport { checkCollision, createStage } from \"../../gameHelpers\";\nimport Preview from \"./Preview\";\nimport { queue } from \"../../constants\";\n\n\nconst Tetris = ({setIsStart}) => {\n    const [isPlaying, setIsPlaying] = useState(false);\n\n    const [dropTime, setDropTime] = useState(null);\n    const [gameOver, setGameOver] = useState(false);\n\n    const [player, updatePlayerPos, resetPlayer, playerRotate] = usePlayer();\n    const [stage, setStage, rowsCleared, ghostPositions] = useStage(player, resetPlayer);\n    const [score, setScore, rows, setRows, level, setlevel] = useStats(rowsCleared);\n\n    const movePlayer = dir => {\n        // check x-1, x+1\n        if(!checkCollision(player, stage, { x: dir, y: 0 })) {\n            updatePlayerPos({ x: dir, y: 0 });\n        }\n    }\n\n    const startGame = (e) => {\n        setIsPlaying(true);\n        const target = document.getElementById('TetrisWrpper');\n        e.target.blur();\n        target.focus();\n        // Reset all\n        setDropTime(1000);\n        setStage(createStage());\n        resetPlayer();\n        setGameOver(false);\n        setScore(0);\n        setRows(0);\n        setlevel(1);\n    }\n    \n    const drop = () => {\n        //레벨 증가\n        if(rows > (level + 1) * 10) {\n            setlevel(prev => prev + 1);\n            // 속도 증가\n            setDropTime(1000 / (level + 1) + 200);\n        }\n        \n        if(!checkCollision(player, stage, { x: 0, y: 1})) {\n            //다음 y좌표가 이동이 가능하면 블럭 한칸 내림\n            updatePlayerPos({ x: 0, y: 1, collide: false })\n        } else { \n            //Game Over\n            //다음 y좌표 이동 불가 + 현재 죄표가 1보다 작다면? Game Over\n            if(player.pos.y < 1) {\n                // console.log('Game Over!!!');\n                setGameOver(true);\n                setDropTime(null);\n            }\n            updatePlayerPos({x: 0, y: 0, collide: true});\n            setDropTime(1000 / (level + 1) + 200);\n        }\n    }\n    const keyUp = ({ keyCode }) => {\n        if(!gameOver) {\n            if(keyCode === 40) {\n                setDropTime(1000);\n            }\n        }\n    }\n    \n    const dropPlayer = () => {\n        setDropTime(null);\n        drop();\n    }\n    const hardDrop = () => {\n        setDropTime(0);\n    }\n\n    const move = ({ keyCode }) => {\n        if(!gameOver) {\n            if(keyCode === 37) {\n                movePlayer(-1);\n            } else if (keyCode === 39) {\n                movePlayer(1);\n            } else if (keyCode === 38) {\n                playerRotate(stage, 1);                \n            } else if (keyCode === 32) {\n                hardDrop();\n            } else if (keyCode === 40) {\n                dropPlayer();\n            }\n        }\n    }\n\n\n    useInterval(() => {\n        drop();\n    }, dropTime);\n\n    return(\n        <StyledTetrisWrapper id=\"TetrisWrpper\" role='button' tabIndex='0' onKeyDown={e => move(e)} onKeyUp={keyUp}>\n            {gameOver ? (<GameOver score={score} restart = {startGame} setIsStart = {setIsStart}/>) : (\n            <StyledTetris>\n                {/* ghost prop은 [] 형태로 pos값들을 저장함 */}\n                <Stage stage={ stage } ghostPos={ghostPositions} />\n                <aside>\n                    <Preview queue={queue} />\n                    <div>\n                        <Display text={`Score : ${score}`} />\n                        <Display text={`Lines : ${rows}`} />\n                        <Display text={`Level : ${level}`} />\n                        <StartButton callback={startGame} isPlaying={isPlaying} />\n                    </div>\n                </aside>\n            </StyledTetris>\n            )}\n        </StyledTetrisWrapper>\n    );\n}\n\nexport default Tetris;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}