{"ast":null,"code":"import _objectSpread from\"/Users/Pajamas/Project/tetris_pro/tetris/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/Pajamas/Project/tetris_pro/tetris/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from\"react\";import{checkCollision,createStage}from\"../../gameHelpers\";export var useStage=function useStage(player,resetPlayer){var _useState=useState(createStage()),_useState2=_slicedToArray(_useState,2),stage=_useState2[0],setStage=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),rowsCleared=_useState4[0],setRowsCleared=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),ghostPositions=_useState6[0],setGhostPositions=_useState6[1];useEffect(function(){setRowsCleared(0);var sweepRows=function sweepRows(newStage){return newStage.reduce(function(ack,row){if(row.findIndex(function(cell){return cell[0]===0;})===-1){setRowsCleared(function(prev){return prev+1;});ack.unshift(new Array(newStage[0].length).fill([0,'clear']));return ack;}ack.push(row);return ack;},[]);};var calculateGhostPos=function calculateGhostPos(stage){var ghostPos=[];var clonedPlayer=JSON.parse(JSON.stringify(player));for(var i=0;i<20;i++){if(checkCollision(clonedPlayer,stage,{x:0,y:1})){break;}else{clonedPlayer.pos.y+=1;}}var calculatedPos=_objectSpread({},clonedPlayer.pos);clonedPlayer.tetromino.forEach(function(row,y){row.forEach(function(value,x){if(value!==0){ghostPos.push({x:x+calculatedPos.x,y:y+calculatedPos.y});}});});return ghostPos;};// Ghost Position \nsetGhostPositions(calculateGhostPos(stage));var updateStage=function updateStage(prevStage){var newStage=prevStage.map(function(row){return row.map(function(cell){return cell[1]==='clear'?[0,'clear']:cell;});});player.tetromino.forEach(function(row,y){row.forEach(function(value,x){if(value!==0){newStage[y+player.pos.y][x+player.pos.x]=[value,\"\".concat(player.collide?'merged':'clear')];}});});//충돌 감지시 새 블럭 생성\nif(player.collide){resetPlayer();return sweepRows(newStage);}return newStage;};// Update Block Position as Stage State\nsetStage(function(prev){return updateStage(prev);});// eslint-disable-next-line react-hooks/exhaustive-deps\n},[player,resetPlayer]);return[stage,setStage,rowsCleared,ghostPositions];};","map":{"version":3,"names":["useState","useEffect","checkCollision","createStage","useStage","player","resetPlayer","_useState","_useState2","_slicedToArray","stage","setStage","_useState3","_useState4","rowsCleared","setRowsCleared","_useState5","_useState6","ghostPositions","setGhostPositions","sweepRows","newStage","reduce","ack","row","findIndex","cell","prev","unshift","Array","length","fill","push","calculateGhostPos","ghostPos","clonedPlayer","JSON","parse","stringify","i","x","y","pos","calculatedPos","_objectSpread","tetromino","forEach","value","updateStage","prevStage","map","concat","collide"],"sources":["/Users/Pajamas/Project/tetris_pro/tetris/src/hooks/tetris/useStage.js"],"sourcesContent":["import { useState, useEffect } from \"react\";\n\nimport { checkCollision, createStage } from \"../../gameHelpers\";\n\nexport const useStage = (player, resetPlayer) => {\n    const [stage, setStage] = useState(createStage());\n    const [rowsCleared, setRowsCleared] = useState(0);    \n    const [ghostPositions, setGhostPositions] = useState([]);\n\n    \n\n\n    useEffect( () => {\n        setRowsCleared(0);\n\n        const sweepRows = newStage => \n            newStage.reduce((ack, row) => {\n                if(row.findIndex(cell => cell[0] === 0) ===-1) {\n                    setRowsCleared(prev => prev + 1);\n                    ack.unshift(new Array(newStage[0].length).fill([0, 'clear']));\n                    return ack;\n                }\n                ack.push(row);\n                return ack;\n            }, []);\n\n        const calculateGhostPos = (stage) => {\n            const ghostPos = [];\n            const clonedPlayer = JSON.parse(JSON.stringify(player));\n            \n            for(let i=0; i<20; i++) {\n                if(checkCollision(clonedPlayer, stage, {x: 0, y: 1})) {\n                    break;\n                } else {\n                    clonedPlayer.pos.y += 1;\n                }\n            }\n            \n            const calculatedPos = {...clonedPlayer.pos};\n\n            clonedPlayer.tetromino.forEach((row, y) => {\n                row.forEach((value, x) => {\n                    if(value !== 0) {\n                        ghostPos.push({x: x + calculatedPos.x, y: y + calculatedPos.y});\n                    }   \n                })\n            })            \n            return ghostPos;\n        }\n        // Ghost Position \n        setGhostPositions(calculateGhostPos(stage));\n\n        const updateStage = prevStage => {\n            const newStage = prevStage.map(row => row.map(cell => (cell[1] === 'clear' ? [0, 'clear'] : cell)));\n            \n            player.tetromino.forEach((row, y) => {\n                row.forEach((value, x) => {\n                    if(value !== 0) {\n                        newStage[y + player.pos.y][x + player.pos.x] = [value, `${player.collide ? 'merged' : 'clear'}`];\n                    }\n                })\n            });\n            \n            //충돌 감지시 새 블럭 생성\n            if(player.collide) {  \n                resetPlayer() \n                return sweepRows(newStage);\n            }\n            return newStage;\n        }\n        \n        // Update Block Position as Stage State\n        setStage(prev => updateStage(prev));\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [player, resetPlayer]);\n\n    return [stage, setStage, rowsCleared, ghostPositions];\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}